
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>心情日記</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f8bbd0">
<style>
    body {
        font-family: "Microsoft JhengHei", sans-serif;
        background: linear-gradient(135deg, #ffd6e8, #f5d0fe);
        margin: 0;
        padding: 0;
        color: #5b2245;
    }
    header {
        background: rgba(255,255,255,0.9);
        padding: 15px;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        color: #d81b60;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    nav {
        display: flex;
        justify-content: space-around;
        background: rgba(255,255,255,0.9);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 10;
    }
    nav button {
        flex: 1;
        padding: 10px 0;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #d81b60;
        transition: background 0.3s;
    }
    nav button.active {
        background: linear-gradient(135deg, #ffb6c1, #ff80ab);
        color: white;
        font-weight: bold;
    }
    .container {
        padding: 15px;
        max-width: 800px;
        margin: auto;
    }
    .card {
        background: rgba(255,255,255,0.92);
        border-radius: 20px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    h2 {
        margin-top: 0;
        font-size: 18px;
    }
    textarea, input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 10px;
        border: 1px solid #ffb6c1;
        font-size: 14px;
    }
    button {
        background: linear-gradient(135deg, #ffb6c1, #ff80ab);
        border: none;
        padding: 6px 12px;
        border-radius: 15px;
        cursor: pointer;
        color: white;
        margin-top: 5px;
        font-size: 14px;
    }
    .emoji-btn {
        font-size: 26px;
        padding: 8px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
        margin: 5px;
        border: 2px solid #f8bbd0;
        transition: 0.2s;
    }
    .emoji-btn:hover {
        transform: scale(1.2);
        background: #fce4ec;
    }
    .todo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fce4ec;
        padding: 6px 10px;
        border-radius: 12px;
        margin-top: 5px;
    }
    .todo-item.completed {
        text-decoration: line-through;
        color: gray;
    }
    #loginPage {
        max-width: 400px;
        margin: auto;
        padding: 20px;
    }
</style>
</head>
<body>

<header>🌸 心情日記</header>
<div id="loginPage" class="container">
    <div class="card">
        <h2>登入 / 註冊</h2>
        <input id="username" placeholder="帳號">
        <input id="password" type="password" placeholder="密碼">
        <button onclick="login()">登入</button>
        <button onclick="register()">註冊</button>
        <p id="loginMsg" style="color:red;"></p>
    </div>
</div>

<div id="mainPage" style="display:none;">
    <nav>
        <button id="tabMood" onclick="showTab('mood')" class="active">心情</button>
        <button id="tabGoals" onclick="showTab('goals')">目標</button>
        <button id="tabEncourage" onclick="showTab('encourage')">鼓勵</button>
        <button id="tabSettings" onclick="showTab('settings')">設定</button>
    </nav>

    <div class="container">
        <div id="pageMood">
            <div class="card">
                <h2>🌼 每日心情</h2>
                <input type="date" id="moodDate">
                <div>
                    <button class="emoji-btn" onclick="selectMood(1)">😭</button>
                    <button class="emoji-btn" onclick="selectMood(2)">😔</button>
                    <button class="emoji-btn" onclick="selectMood(3)">🙂</button>
                    <button class="emoji-btn" onclick="selectMood(4)">😄</button>
                    <button class="emoji-btn" onclick="selectMood(5)">😍</button>
                </div>
                <input id="moodTag" placeholder="主題標籤（可選）">
                <textarea id="moodText" placeholder="想法／記錄"></textarea>
                <button onclick="saveMood()">儲存心情</button>
                <div id="moodList"></div>
            </div>
        </div>

        <div id="pageGoals" style="display:none;">
            <div class="card">
                <h2>📋 每日 To-do List</h2>
                <input id="todoInput" placeholder="輸入待辦事項">
                <button onclick="addTodo()">新增</button>
                <div id="todoList"></div>
            </div>

            <div class="card">
                <h2>🎯 短期目標</h2>
                <input id="shortGoal" placeholder="輸入短期目標">
                <button onclick="saveGoal('short')">儲存</button>
                <div id="shortGoalList"></div>
            </div>

            <div class="card">
                <h2>🌟 長期目標</h2>
                <input id="longGoal" placeholder="輸入長期目標">
                <button onclick="saveGoal('long')">儲存</button>
                <div id="longGoalList"></div>
            </div>

            <div class="card">
                <h2>💰 每日記帳</h2>
                <input id="moneyNote" placeholder="項目">
                <input id="moneyAmount" type="number" placeholder="金額">
                <button onclick="addMoney()">新增記帳</button>
                <div id="moneyList"></div>
            </div>
        </div>

        <div id="pageEncourage" style="display:none;">
            <div class="card">
                <h2>💖 每日鼓勵自己的一句話</h2>
                <input id="encourageInput" placeholder="輸入鼓勵自己的話">
                <button onclick="saveEncourage()">儲存</button>
                <p id="encourageText"></p>
            </div>
        </div>

        <div id="pageSettings" style="display:none;">
            <div class="card">
                <h2>⚙️ 設定</h2>
                <button onclick="clearData()">清除所有資料</button>
                <button onclick="exportData()">匯出資料</button>
                <input type="file" id="importFile" onchange="importData(event)">
            </div>
            <div class="card">
                <button onclick="logout()">登出</button>
            </div>
        </div>
    </div>
</div>

<script>
let selectedMood = null;

function showTab(tab) {
    document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
    document.getElementById("tab" + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add("active");
    document.getElementById("pageMood").style.display = tab === "mood" ? "block" : "none";
    document.getElementById("pageGoals").style.display = tab === "goals" ? "block" : "none";
    document.getElementById("pageEncourage").style.display = tab === "encourage" ? "block" : "none";
    document.getElementById("pageSettings").style.display = tab === "settings" ? "block" : "none";
}

function selectMood(score) { selectedMood = score; }

function login() {
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;
    let savedUser = localStorage.getItem("diaryUser");
    let savedPass = localStorage.getItem("diaryPass");
    if (user === savedUser && pass === savedPass) {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("mainPage").style.display = "block";
        loadData();
    } else {
        document.getElementById("loginMsg").innerText = "帳號或密碼錯誤";
    }
}

function register() {
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;
    if (!user || !pass) {
        document.getElementById("loginMsg").innerText = "請輸入帳號和密碼";
        return;
    }
    localStorage.setItem("diaryUser", user);
    localStorage.setItem("diaryPass", pass);
    document.getElementById("loginMsg").style.color = "green";
    document.getElementById("loginMsg").innerText = "註冊成功，請重新登入";
}

function logout() {
    document.getElementById("mainPage").style.display = "none";
    document.getElementById("loginPage").style.display = "block";
}

function loadData() {
    document.getElementById("moodList").innerHTML = (JSON.parse(localStorage.getItem("moods")) || [])
        .map(m => `<div>${m.date} ${m.tag || ""} 分數:${m.score} ${m.text}</div>`).join("");
    document.getElementById("shortGoalList").innerHTML = (JSON.parse(localStorage.getItem("shortGoals")) || []).map(g => `<div>${g}</div>`).join("");
    document.getElementById("longGoalList").innerHTML = (JSON.parse(localStorage.getItem("longGoals")) || []).map(g => `<div>${g}</div>`).join("");
    document.getElementById("todoList").innerHTML = (JSON.parse(localStorage.getItem("todos")) || []).map((t,i) => `<div class="todo-item ${t.done ? 'completed':''}" onclick="toggleTodo(${i})">${t.text} <button onclick="deleteTodo(${i});event.stopPropagation()">刪除</button></div>`).join("");
    document.getElementById("moneyList").innerHTML = (JSON.parse(localStorage.getItem("money")) || []).map(m => `<div>${m.item} - $${m.amount}</div>`).join("");
    document.getElementById("encourageText").innerText = localStorage.getItem("encourage") || "";
}

function saveMood() {
    let date = document.getElementById("moodDate").value;
    let tag = document.getElementById("moodTag").value;
    let text = document.getElementById("moodText").value;
    if (!date || !selectedMood) return;
    let moods = JSON.parse(localStorage.getItem("moods")) || [];
    moods.push({ date, tag, score:selectedMood, text });
    localStorage.setItem("moods", JSON.stringify(moods));
    loadData();
}

function saveGoal(type) {
    let input = document.getElementById(type === "short" ? "shortGoal" : "longGoal");
    let goals = JSON.parse(localStorage.getItem(type === "short" ? "shortGoals" : "longGoals")) || [];
    if (!input.value) return;
    goals.push(input.value);
    localStorage.setItem(type === "short" ? "shortGoals" : "longGoals", JSON.stringify(goals));
    input.value = "";
    loadData();
}

function addTodo() {
    let todo = document.getElementById("todoInput").value;
    if (!todo) return;
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    todos.push({ text: todo, done:false });
    localStorage.setItem("todos", JSON.stringify(todos));
    document.getElementById("todoInput").value = "";
    loadData();
}

function toggleTodo(index) {
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    todos[index].done = !todos[index].done;
    localStorage.setItem("todos", JSON.stringify(todos));
    loadData();
}

function deleteTodo(index) {
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    todos.splice(index,1);
    localStorage.setItem("todos", JSON.stringify(todos));
    loadData();
}

function addMoney() {
    let item = document.getElementById("moneyNote").value;
    let amount = document.getElementById("moneyAmount").value;
    if (!item || !amount) return;
    let money = JSON.parse(localStorage.getItem("money")) || [];
    money.push({ item, amount });
    localStorage.setItem("money", JSON.stringify(money));
    document.getElementById("moneyNote").value = "";
    document.getElementById("moneyAmount").value = "";
    loadData();
}

function saveEncourage() {
    let text = document.getElementById("encourageInput").value;
    if (!text) return;
    localStorage.setItem("encourage", text);
    loadData();
}

function clearData() {
    if (confirm("確定要清除所有資料嗎？")) {
        localStorage.clear();
        alert("已清除所有資料");
        loadData();
    }
}

function exportData() {
    const data = {
        moods: JSON.parse(localStorage.getItem("moods")) || [],
        shortGoals: JSON.parse(localStorage.getItem("shortGoals")) || [],
        longGoals: JSON.parse(localStorage.getItem("longGoals")) || [],
        todos: JSON.parse(localStorage.getItem("todos")) || [],
        money: JSON.parse(localStorage.getItem("money")) || [],
        encourage: localStorage.getItem("encourage") || ""
    };
    const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "diary-data.json";
    a.click();
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            localStorage.setItem("moods", JSON.stringify(data.moods || []));
            localStorage.setItem("shortGoals", JSON.stringify(data.shortGoals || []));
            localStorage.setItem("longGoals", JSON.stringify(data.longGoals || []));
            localStorage.setItem("todos", JSON.stringify(data.todos || []));
            localStorage.setItem("money", JSON.stringify(data.money || []));
            localStorage.setItem("encourage", data.encourage || "");
            alert("資料已匯入");
            loadData();
        } catch (err) {
            alert("匯入失敗");
        }
    };
    reader.readAsText(file);
}

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>

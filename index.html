
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿ƒæƒ…æ—¥è¨˜</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f8bbd0">
<style>
    body {
        font-family: "Microsoft JhengHei", sans-serif;
        background: linear-gradient(135deg, #ffd6e8, #f5d0fe);
        margin: 0;
        padding: 0;
        color: #5b2245;
    }
    header {
        background: rgba(255,255,255,0.9);
        padding: 15px;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        color: #d81b60;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    nav {
        display: flex;
        justify-content: space-around;
        background: rgba(255,255,255,0.9);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 10;
    }
    nav button {
        flex: 1;
        padding: 10px 0;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #d81b60;
        transition: background 0.3s;
    }
    nav button.active {
        background: linear-gradient(135deg, #ffb6c1, #ff80ab);
        color: white;
        font-weight: bold;
    }
    .container {
        padding: 15px;
        max-width: 800px;
        margin: auto;
    }
    .card {
        background: rgba(255,255,255,0.92);
        border-radius: 20px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    h2 {
        margin-top: 0;
        font-size: 18px;
    }
    textarea, input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 10px;
        border: 1px solid #ffb6c1;
        font-size: 14px;
    }
    button {
        background: linear-gradient(135deg, #ffb6c1, #ff80ab);
        border: none;
        padding: 6px 12px;
        border-radius: 15px;
        cursor: pointer;
        color: white;
        margin-top: 5px;
        font-size: 14px;
    }
    .emoji-btn {
        font-size: 26px;
        padding: 8px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
        margin: 5px;
        border: 2px solid #f8bbd0;
        transition: 0.2s;
    }
    .emoji-btn:hover {
        transform: scale(1.2);
        background: #fce4ec;
    }
    .todo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fce4ec;
        padding: 6px 10px;
        border-radius: 12px;
        margin-top: 5px;
    }
    .todo-item.completed {
        text-decoration: line-through;
        color: gray;
    }
    #loginPage {
        max-width: 400px;
        margin: auto;
        padding: 20px;
    }
</style>
</head>
<body>

<header>ğŸŒ¸ å¿ƒæƒ…æ—¥è¨˜</header>
<div id="loginPage" class="container">
    <div class="card">
        <h2>ç™»å…¥ / è¨»å†Š</h2>
        <input id="username" placeholder="å¸³è™Ÿ">
        <input id="password" type="password" placeholder="å¯†ç¢¼">
        <button onclick="login()">ç™»å…¥</button>
        <button onclick="register()">è¨»å†Š</button>
        <p id="loginMsg" style="color:red;"></p>
    </div>
</div>

<div id="mainPage" style="display:none;">
    <nav>
        <button id="tabMood" onclick="showTab('mood')" class="active">å¿ƒæƒ…</button>
        <button id="tabGoals" onclick="showTab('goals')">ç›®æ¨™</button>
        <button id="tabEncourage" onclick="showTab('encourage')">é¼“å‹µ</button>
        <button id="tabSettings" onclick="showTab('settings')">è¨­å®š</button>
    </nav>

    <div class="container">
        <div id="pageMood">
            <div class="card">
                <h2>ğŸŒ¼ æ¯æ—¥å¿ƒæƒ…</h2>
                <input type="date" id="moodDate">
                <div>
                    <button class="emoji-btn" onclick="selectMood(1)">ğŸ˜­</button>
                    <button class="emoji-btn" onclick="selectMood(2)">ğŸ˜”</button>
                    <button class="emoji-btn" onclick="selectMood(3)">ğŸ™‚</button>
                    <button class="emoji-btn" onclick="selectMood(4)">ğŸ˜„</button>
                    <button class="emoji-btn" onclick="selectMood(5)">ğŸ˜</button>
                </div>
                <input id="moodTag" placeholder="ä¸»é¡Œæ¨™ç±¤ï¼ˆå¯é¸ï¼‰">
                <textarea id="moodText" placeholder="æƒ³æ³•ï¼è¨˜éŒ„"></textarea>
                <button onclick="saveMood()">å„²å­˜å¿ƒæƒ…</button>
                <div id="moodList"></div>
            </div>
        </div>

        <div id="pageGoals" style="display:none;">
            <div class="card">
                <h2>ğŸ“‹ æ¯æ—¥ To-do List</h2>
                <input id="todoInput" placeholder="è¼¸å…¥å¾…è¾¦äº‹é …">
                <button onclick="addTodo()">æ–°å¢</button>
                <div id="todoList"></div>
            </div>

            <div class="card">
                <h2>ğŸ¯ çŸ­æœŸç›®æ¨™</h2>
                <input id="shortGoal" placeholder="è¼¸å…¥çŸ­æœŸç›®æ¨™">
                <button onclick="saveGoal('short')">å„²å­˜</button>
                <div id="shortGoalList"></div>
            </div>

            <div class="card">
                <h2>ğŸŒŸ é•·æœŸç›®æ¨™</h2>
                <input id="longGoal" placeholder="è¼¸å…¥é•·æœŸç›®æ¨™">
                <button onclick="saveGoal('long')">å„²å­˜</button>
                <div id="longGoalList"></div>
            </div>

            <div class="card">
                <h2>ğŸ’° æ¯æ—¥è¨˜å¸³</h2>
                <input id="moneyNote" placeholder="é …ç›®">
                <input id="moneyAmount" type="number" placeholder="é‡‘é¡">
                <button onclick="addMoney()">æ–°å¢è¨˜å¸³</button>
                <div id="moneyList"></div>
            </div>
        </div>

        <div id="pageEncourage" style="display:none;">
            <div class="card">
                <h2>ğŸ’– æ¯æ—¥é¼“å‹µè‡ªå·±çš„ä¸€å¥è©±</h2>
                <input id="encourageInput" placeholder="è¼¸å…¥é¼“å‹µè‡ªå·±çš„è©±">
                <button onclick="saveEncourage()">å„²å­˜</button>
                <p id="encourageText"></p>
            </div>
        </div>

        <div id="pageSettings" style="display:none;">
            <div class="card">
                <h2>âš™ï¸ è¨­å®š</h2>
                <button onclick="clearData()">æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
                <button onclick="exportData()">åŒ¯å‡ºè³‡æ–™</button>
                <input type="file" id="importFile" onchange="importData(event)">
            </div>
            <div class="card">
                <button onclick="logout()">ç™»å‡º</button>
            </div>
        </div>
    </div>
</div>

<script>
let selectedMood = null;

function showTab(tab) {
    document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
    document.getElementById("tab" + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add("active");
    document.getElementById("pageMood").style.display = tab === "mood" ? "block" : "none";
    document.getElementById("pageGoals").style.display = tab === "goals" ? "block" : "none";
    document.getElementById("pageEncourage").style.display = tab === "encourage" ? "block" : "none";
    document.getElementById("pageSettings").style.display = tab === "settings" ? "block" : "none";
}

function selectMood(score) { selectedMood = score; }

function login() {
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;
    let savedUser = localStorage.getItem("diaryUser");
    let savedPass = localStorage.getItem("diaryPass");
    if (user === savedUser && pass === savedPass) {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("mainPage").style.display = "block";
        loadData();
    } else {
        document.getElementById("loginMsg").innerText = "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤";
    }
}

function register() {
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;
    if (!user || !pass) {
        document.getElementById("loginMsg").innerText = "è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼";
        return;
    }
    localStorage.setItem("diaryUser", user);
    localStorage.setItem("diaryPass", pass);
    document.getElementById("loginMsg").style.color = "green";
    document.getElementById("loginMsg").innerText = "è¨»å†ŠæˆåŠŸï¼Œè«‹é‡æ–°ç™»å…¥";
}

function logout() {
    document.getElementById("mainPage").style.display = "none";
    document.getElementById("loginPage").style.display = "block";
}

function loadData() {
    document.getElementById("moodList").innerHTML = (JSON.parse(localStorage.getItem("moods")) || [])
        .map(m => `<div>${m.date} ${m.tag || ""} åˆ†æ•¸:${m.score} ${m.text}</div>`).join("");
    document.getElementById("shortGoalList").innerHTML = (JSON.parse(localStorage.getItem("shortGoals")) || []).map(g => `<div>${g}</div>`).join("");
    document.getElementById("longGoalList").innerHTML = (JSON.parse(localStorage.getItem("longGoals")) || []).map(g => `<div>${g}</div>`).join("");
    document.getElementById("todoList").innerHTML = (JSON.parse(localStorage.getItem("todos")) || []).map((t,i) => `<div class="todo-item ${t.done ? 'completed':''}" onclick="toggleTodo(${i})">${t.text} <button onclick="deleteTodo(${i});event.stopPropagation()">åˆªé™¤</button></div>`).join("");
    document.getElementById("moneyList").innerHTML = (JSON.parse(localStorage.getItem("money")) || []).map(m => `<div>${m.item} - $${m.amount}</div>`).join("");
    document.getElementById("encourageText").innerText = localStorage.getItem("encourage") || "";
}

function saveMood() {
    let date = document.getElementById("moodDate").value;
    let tag = document.getElementById("moodTag").value;
    let text = document.getElementById("moodText").value;
    if (!date || !selectedMood) return;
    let moods = JSON.parse(localStorage.getItem("moods")) || [];
    moods.push({ date, tag, score:selectedMood, text });
    localStorage.setItem("moods", JSON.stringify(moods));
    loadData();
}

function saveGoal(type) {
    let input = document.getElementById(type === "short" ? "shortGoal" : "longGoal");
    let goals = JSON.parse(localStorage.getItem(type === "short" ? "shortGoals" : "longGoals")) || [];
    if (!input.value) return;
    goals.push(input.value);
    localStorage.setItem(type === "short" ? "shortGoals" : "longGoals", JSON.stringify(goals));
    input.value = "";
    loadData();
}

function addTodo() {
    let todo = document.getElementById("todoInput").value;
    if (!todo) return;
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    todos.push({ text: todo, done:false });
    localStorage.setItem("todos", JSON.stringify(todos));
    document.getElementById("todoInput").value = "";
    loadData();
}

function toggleTodo(index) {
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    todos[index].done = !todos[index].done;
    localStorage.setItem("todos", JSON.stringify(todos));
    loadData();
}

function deleteTodo(index) {
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    todos.splice(index,1);
    localStorage.setItem("todos", JSON.stringify(todos));
    loadData();
}

function addMoney() {
    let item = document.getElementById("moneyNote").value;
    let amount = document.getElementById("moneyAmount").value;
    if (!item || !amount) return;
    let money = JSON.parse(localStorage.getItem("money")) || [];
    money.push({ item, amount });
    localStorage.setItem("money", JSON.stringify(money));
    document.getElementById("moneyNote").value = "";
    document.getElementById("moneyAmount").value = "";
    loadData();
}

function saveEncourage() {
    let text = document.getElementById("encourageInput").value;
    if (!text) return;
    localStorage.setItem("encourage", text);
    loadData();
}

function clearData() {
    if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ")) {
        localStorage.clear();
        alert("å·²æ¸…é™¤æ‰€æœ‰è³‡æ–™");
        loadData();
    }
}

function exportData() {
    const data = {
        moods: JSON.parse(localStorage.getItem("moods")) || [],
        shortGoals: JSON.parse(localStorage.getItem("shortGoals")) || [],
        longGoals: JSON.parse(localStorage.getItem("longGoals")) || [],
        todos: JSON.parse(localStorage.getItem("todos")) || [],
        money: JSON.parse(localStorage.getItem("money")) || [],
        encourage: localStorage.getItem("encourage") || ""
    };
    const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "diary-data.json";
    a.click();
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            localStorage.setItem("moods", JSON.stringify(data.moods || []));
            localStorage.setItem("shortGoals", JSON.stringify(data.shortGoals || []));
            localStorage.setItem("longGoals", JSON.stringify(data.longGoals || []));
            localStorage.setItem("todos", JSON.stringify(data.todos || []));
            localStorage.setItem("money", JSON.stringify(data.money || []));
            localStorage.setItem("encourage", data.encourage || "");
            alert("è³‡æ–™å·²åŒ¯å…¥");
            loadData();
        } catch (err) {
            alert("åŒ¯å…¥å¤±æ•—");
        }
    };
    reader.readAsText(file);
}

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
